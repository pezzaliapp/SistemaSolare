<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema Solare Realistico</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
    #info {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 14px;
      text-shadow: 0 0 5px black;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="info">Sistema Solare – Usa il mouse per ruotare, la rotella per zoomare</div>

  <!-- Importa Three.js da CDN -->
  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.1/examples/jsm/controls/OrbitControls.js';

    // ======================
    // CONFIGURAZIONE SCENA
    // ======================
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 10000);
    camera.position.set(0, 100, 300);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    // Luce solare (emessa dal Sole)
    const sunLight = new THREE.PointLight(0xffffff, 2, 1000);
    scene.add(sunLight);

    // ======================
    // COSTANTI REALISTICHE (SCALATE)
    // ======================
    // Scala per distanze (1 unità = 1 milione di km)
    const DISTANCE_SCALE = 0.0005; // Ridotto per visualizzazione
    // Scala per dimensioni (1 unità = 1000 km)
    const SIZE_SCALE = 0.002;

    // Dati realistici: [nome, raggio (km), distanza media dal Sole (milioni di km), periodo orbitale (giorni), inclinazione (gradi), texture]
    const planetsData = [
      { name: "Mercurio", radius: 2440, distance: 57.9, orbitalPeriod: 88, inclination: 7, texture: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/mercury.jpg" },
      { name: "Venere", radius: 6052, distance: 108.2, orbitalPeriod: 225, inclination: 3.4, texture: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/venus.jpg" },
      { name: "Terra", radius: 6371, distance: 149.6, orbitalPeriod: 365, inclination: 0, texture: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth.jpg" },
      { name: "Marte", radius: 3390, distance: 227.9, orbitalPeriod: 687, inclination: 1.9, texture: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/mars.jpg" },
      { name: "Giove", radius: 69911, distance: 778.5, orbitalPeriod: 4333, inclination: 1.3, texture: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/jupiter.jpg" },
      { name: "Saturno", radius: 58232, distance: 1432, orbitalPeriod: 10759, inclination: 2.5, texture: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/saturn.jpg" },
      { name: "Urano", radius: 25362, distance: 2867, orbitalPeriod: 30687, inclination: 0.8, texture: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/uranus.jpg" },
      { name: "Nettuno", radius: 24622, distance: 4515, orbitalPeriod: 60190, inclination: 1.8, texture: "https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/neptune.jpg" }
    ];

    // ======================
    // CREAZIONE OGGETTI
    // ======================
    const loader = new THREE.TextureLoader();

    // Sole
    const sunGeometry = new THREE.SphereGeometry(696340 * SIZE_SCALE, 64, 64);
    const sunMaterial = new THREE.MeshBasicMaterial({ map: loader.load("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/sun.jpg") });
    const sun = new THREE.Mesh(sunGeometry, sunMaterial);
    scene.add(sun);

    // Array per tenere traccia dei pianeti e dei loro dati
    const planets = [];

    planetsData.forEach(data => {
      // Sfera del pianeta
      const geometry = new THREE.SphereGeometry(data.radius * SIZE_SCALE, 32, 32);
      const material = new THREE.MeshPhongMaterial({ map: loader.load(data.texture) });
      const planet = new THREE.Mesh(geometry, material);

      // Posizione iniziale (sull'asse X)
      const distance = data.distance * DISTANCE_SCALE;
      planet.position.x = distance;

      // Gruppo per orbita e inclinazione
      const orbitGroup = new THREE.Group();
      orbitGroup.rotation.x = THREE.MathUtils.degToRad(data.inclination);
      orbitGroup.add(planet);
      scene.add(orbitGroup);

      // Aggiungi anelli a Saturno
      if (data.name === "Saturno") {
        const ringGeometry = new THREE.RingGeometry(
          data.radius * SIZE_SCALE * 1.5,
          data.radius * SIZE_SCALE * 2.5,
          64
        );
        const ringMaterial = new THREE.MeshPhongMaterial({
          map: loader.load("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/saturn-rings.png"),
          side: THREE.DoubleSide,
          transparent: true
        });
        const ring = new THREE.Mesh(ringGeometry, ringMaterial);
        ring.rotation.x = Math.PI / 2;
        planet.add(ring);
      }

      planets.push({
        mesh: planet,
        group: orbitGroup,
        distance: distance,
        orbitalPeriod: data.orbitalPeriod,
        rotationSpeed: 1 / (data.radius / 1000) // Rotazione su sé stessi (approssimata)
      });
    });

    // ======================
    // ANIMAZIONE
    // ======================
    const clock = new THREE.Clock();

    function animate() {
      requestAnimationFrame(animate);

      const delta = clock.getDelta();
      const elapsedTime = clock.getElapsedTime();

      // Rotazione Sole
      sun.rotation.y += 0.001;

      // Movimento pianeti
      planets.forEach(p => {
        // Orbita
        const angle = (elapsedTime / p.orbitalPeriod) * Math.PI * 2;
        p.mesh.position.x = Math.cos(angle) * p.distance;
        p.mesh.position.z = Math.sin(angle) * p.distance;

        // Rotazione su sé stessi
        p.mesh.rotation.y += p.rotationSpeed * delta * 5;
      });

      controls.update();
      renderer.render(scene, camera);
    }

    animate();

    // ======================
    // GESTIONE FINESTRA
    // ======================
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
