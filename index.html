<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema Solare Realistico</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    canvas { display: block; }
    #info {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 14px;
      text-shadow: 0 0 5px black;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="info">Sistema Solare – Trascina per ruotare, rotella per zoomare</div>

  <!-- Carica Three.js da CDN (versione UMD per compatibilità) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.1/examples/js/controls/OrbitControls.js"></script>

  <script>
    // ======================
    // CONFIGURAZIONE SCENA
    // ======================
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 10000);
    camera.position.set(0, 100, 300);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    // Luce solare
    const sunLight = new THREE.PointLight(0xffffff, 2, 1000);
    scene.add(sunLight);
    scene.add(new THREE.AmbientLight(0x222222)); // Luce ambientale minima

    // ======================
    // SCALING (per visibilità)
    // ======================
    const DISTANCE_SCALE = 0.008;  // Ridotto per stare nello schermo
    const SIZE_SCALE = 0.0025;

    // Dati pianeti (raggio in km, distanza in milioni di km)
    const planetsData = [
      { name: "Mercurio", radius: 2440, distance: 57.9, orbitalPeriod: 88, inclination: 7, texture: "https://threejs.org/examples/textures/planets/mercury.jpg" },
      { name: "Venere", radius: 6052, distance: 108.2, orbitalPeriod: 225, inclination: 3.4, texture: "https://threejs.org/examples/textures/planets/venus.jpg" },
      { name: "Terra", radius: 6371, distance: 149.6, orbitalPeriod: 365, inclination: 0, texture: "https://threejs.org/examples/textures/planets/earth.jpg" },
      { name: "Marte", radius: 3390, distance: 227.9, orbitalPeriod: 687, inclination: 1.9, texture: "https://threejs.org/examples/textures/planets/mars.jpg" },
      { name: "Giove", radius: 69911, distance: 778.5, orbitalPeriod: 4333, inclination: 1.3, texture: "https://threejs.org/examples/textures/planets/jupiter.jpg" },
      { name: "Saturno", radius: 58232, distance: 1432, orbitalPeriod: 10759, inclination: 2.5, texture: "https://threejs.org/examples/textures/planets/saturn.jpg" },
      { name: "Urano", radius: 25362, distance: 2867, orbitalPeriod: 30687, inclination: 0.8, texture: "https://threejs.org/examples/textures/planets/uranus.jpg" },
      { name: "Nettuno", radius: 24622, distance: 4515, orbitalPeriod: 60190, inclination: 1.8, texture: "https://threejs.org/examples/textures/planets/neptune.jpg" }
    ];

    // ======================
    // CREAZIONE OGGETTI
    // ======================
    const loader = new THREE.TextureLoader();
    const planets = [];

    // Sole
    const sunGeometry = new THREE.SphereGeometry(696340 * SIZE_SCALE, 64, 64);
    const sunMaterial = new THREE.MeshBasicMaterial({
      map: loader.load("https://threejs.org/examples/textures/planets/sun.jpg")
    });
    const sun = new THREE.Mesh(sunGeometry, sunMaterial);
    scene.add(sun);

    // Pianeti
    planetsData.forEach(data => {
      const geometry = new THREE.SphereGeometry(data.radius * SIZE_SCALE, 32, 32);
      const material = new THREE.MeshPhongMaterial({
        map: loader.load(data.texture),
        shininess: 5
      });
      const planet = new THREE.Mesh(geometry, material);

      const distance = data.distance * DISTANCE_SCALE;
      planet.position.x = distance;

      const orbitGroup = new THREE.Group();
      orbitGroup.rotation.x = THREE.MathUtils.degToRad(data.inclination);
      orbitGroup.add(planet);
      scene.add(orbitGroup);

      // Anelli di Saturno
      if (data.name === "Saturno") {
        const ringGeo = new THREE.RingGeometry(
          data.radius * SIZE_SCALE * 1.5,
          data.radius * SIZE_SCALE * 2.5,
          64
        );
        const ringMat = new THREE.MeshPhongMaterial({
          map: loader.load("https://threejs.org/examples/textures/planets/saturn-rings.png"),
          side: THREE.DoubleSide,
          transparent: true
        });
        const ring = new THREE.Mesh(ringGeo, ringMat);
        ring.rotation.x = Math.PI / 2;
        planet.add(ring);
      }

      planets.push({
        mesh: planet,
        group: orbitGroup,
        distance: distance,
        orbitalPeriod: data.orbitalPeriod,
        rotationSpeed: 0.01 * (1000 / data.radius) // Rotazione più veloce per pianeti piccoli
      });
    });

    // ======================
    // ANIMAZIONE
    // ======================
    const clock = new THREE.Clock();

    function animate() {
      requestAnimationFrame(animate);

      const elapsedTime = clock.getElapsedTime();

      // Rotazione Sole
      sun.rotation.y += 0.0005;

      // Movimento pianeti
      planets.forEach(p => {
        const angle = (elapsedTime / p.orbitalPeriod) * Math.PI * 2;
        p.mesh.position.x = Math.cos(angle) * p.distance;
        p.mesh.position.z = Math.sin(angle) * p.distance;
        p.mesh.rotation.y += p.rotationSpeed;
      });

      controls.update();
      renderer.render(scene, camera);
    }

    animate();

    // Resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
